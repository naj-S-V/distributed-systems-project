{% extends "base.html" %}
{% block title %}Create Short Link{% endblock %}
{% block content %}
<h2>Create a new Short Link</h2>
<form id="shorten-form">
    <label for="url">Original URL:</label><br>
    <input type="url" id="url" name="url" required style="width: 80%; padding: 8px;">
    <button type="submit" class="btn">Shorten</button>
</form>

<div id="result" style="margin-top: 20px;"></div>

<script>
document.getElementById("shorten-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const url = document.getElementById("url").value;
    const resultDiv = document.getElementById("result");

    resultDiv.innerHTML = "Processing...";
    try {
        const res = await fetch("/api/shorten", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ original_url: url })
        });
        const data = await res.json();
        if (res.ok) {
            resultDiv.innerHTML = `
                <p><strong>Short URL:</strong> 
                <a href="/r/${data.short_code}" target="_blank">${window.location.origin}/r/${data.short_code}</a></p>`;
        } else {
            resultDiv.innerHTML = `<span style="color:red;">Error: ${data.detail || 'Unknown error'}</span>`;
        }
    } catch (err) {
        resultDiv.innerHTML = `<span style="color:red;">${err.message}</span>`;
    }
});
</script>
{% endblock %}
